<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…ØªØ¬Ø± iron - Ø§Ø´ØªØ±Ø§Ùƒ Ø¨Ù„Ø³</title>
    <style>
        :root { --primary: #007AFF; --success: #2ecc71; --bg: #121212; --card: #1e1e1e; }
        body { font-family: 'Segoe UI', Tahoma, sans-serif; background-color: var(--bg); color: white; margin: 0; padding: 20px; display: flex; justify-content: center; }
        .container { max-width: 450px; width: 100%; }
        .product-card { background: var(--card); border-radius: 20px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.5); border: 1px solid #333; }
        .product-img { width: 100%; height: auto; display: block; }
        .content { padding: 25px; text-align: center; }
        h1 { font-size: 22px; margin-bottom: 5px; }
        .price { font-size: 32px; color: var(--success); font-weight: bold; margin: 15px 0; }
        
        .pay-btn { 
            background: linear-gradient(45deg, var(--primary), #0051af); 
            color: white; border: none; padding: 18px; border-radius: 12px; 
            width: 100%; font-size: 18px; font-weight: bold; cursor: pointer; transition: 0.3s;
        }
        .pay-btn:hover { transform: scale(1.02); box-shadow: 0 5px 15px rgba(0,122,255,0.3); }
        .pay-btn:disabled { background: #444; cursor: not-allowed; }

        #status { margin-top: 10px; font-size: 14px; color: #888; height: 20px; }

        details { background: #2a2a2a; border-radius: 12px; padding: 15px; margin-top: 20px; text-align: right; }
        summary { font-weight: bold; color: #aaa; cursor: pointer; outline: none; }
        .details-text { font-size: 14px; color: #ccc; line-height: 1.6; margin-top: 10px; border-top: 1px solid #444; padding-top: 10px; }

        #successSection { display: none; background: #1a3321; border: 2px dashed var(--success); padding: 20px; border-radius: 15px; margin-top: 20px; }
        .activation-code { font-size: 24px; color: var(--success); font-weight: bold; letter-spacing: 2px; margin: 15px 0; display: block; border: 1px solid #2ecc71; padding: 10px; border-radius: 8px; }
    </style>
</head>
<body>

<div class="container">
    <div class="product-card">
        <img src="https://i.postimg.cc/c44K4tZn/5954065493062782055.jpg" alt="Ø§Ø´ØªØ±Ø§Ùƒ Ø¨Ù„Ø³" class="product-img">
        
        <div class="content">
            <h1>Ø§Ø´ØªØ±Ø§Ùƒ Ø¨Ù„Ø³ Ù„Ù„Ø§ÙŠÙÙˆÙ† (Ø³Ù†Ø©)</h1>
            <div class="price">5 Ø±ÙŠØ§Ù„</div>

            <button onclick="startPayment()" id="payBtn" class="pay-btn">Ø¥ØªÙ…Ø§Ù… Ø§Ù„Ø´Ø±Ø§Ø¡ - ØªÙØ¹ÙŠÙ„ ÙÙˆØ±ÙŠ</button>
            <div id="status"></div>

            <div id="successSection">
                <h3 style="color: var(--success); margin: 0;">ØªÙ… Ø§Ù„Ø¯ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­! âœ“</h3>
                <p style="font-size: 14px;">ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ Ù‡Ùˆ:</p>
                <span class="activation-code">IRON-PLUS-2026-XYZ</span>
                <p style="font-size: 12px; color: #888;">ØµÙˆØ± Ø§Ù„Ø´Ø§Ø´Ø© Ø£Ùˆ Ø§Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯ Ù„ØªÙØ¹ÙŠÙ„ Ø§Ø´ØªØ±Ø§ÙƒÙƒ.</p>
            </div>

            <details>
                <summary>ğŸ“ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¨Ø§Ù‚Ø© ÙˆØ§Ù„Ù…Ù…ÙŠØ²Ø§Øª</summary>
                <div class="details-text">
                    <strong>Ø§Ù„Ù…Ù…ÙŠØ²Ø§Øª:</strong>
                    <ul style="padding-right: 20px;">
                        <li>Ø£ÙƒØ«Ø± Ù…Ù† 5500 ØªØ·Ø¨ÙŠÙ‚ (Ø³Ù†Ø§Ø¨ØŒ ÙŠÙˆØªÙŠÙˆØ¨ØŒ ØªÙŠÙƒ ØªÙˆÙƒ Ø¨Ù„Ø³)</li>
                        <li>ØªÙØ¹ÙŠÙ„ ÙÙˆØ±ÙŠ ÙˆØ¢Ù…Ù† 100%</li>
                        <li>Ø¶Ù…Ø§Ù† Ù„Ù…Ø¯Ø© 3 Ø´Ù‡ÙˆØ± ÙˆØ¯Ø¹Ù… ÙÙ†ÙŠ Ù…Ø³ØªÙ…Ø±</li>
                    </ul>
                </div>
            </details>
        </div>
    </div>
</div>

<script>
    // ÙØ­Øµ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ø¹Ù…ÙŠÙ„ Ø¹Ø§Ø¯ Ù…Ù† ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹ Ø¨Ù†Ø¬Ø§Ø­
    window.onload = function() {
        const params = new URLSearchParams(window.location.search);
        // Paylink ÙŠØ±Ø³Ù„ Ø¹Ø§Ø¯Ø© Ù…Ø¹Ø§Ù…Ù„ Ø§Ù„Ù†Ø¬Ø§Ø­ ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·
        if (params.has('transactionNo') || params.has('orderId') || params.has('success')) {
            document.getElementById('successSection').style.display = 'block';
            document.getElementById('payBtn').style.display = 'none';
            document.getElementById('status').innerText = "Ø´ÙƒØ±Ø§Ù‹ Ù„Ø´Ø±Ø§Ø¦Ùƒ Ù…Ù† Ù…ØªØ¬Ø±Ù†Ø§!";
        }
    }

    async function startPayment() {
        const btn = document.getElementById('payBtn');
        const status = document.getElementById('status');
        
        btn.disabled = true;
        status.innerText = "Ø¬Ø§Ø±ÙŠ ÙØªØ­ Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ø¯ÙØ¹ Ø§Ù„Ø¢Ù…Ù†Ø©...";

        // --- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø±Ø¨Ø· Ø§Ù„Ø®Ø§ØµØ© Ø¨Ùƒ ---
        const PROJECT_ID = "xurecaeakqbsjzebcsuy"; 
        const ANON_KEY = "sb_publishable_N4uzz2OJdyvbcfiyl8dmoQ_mEmAJgG1";

        try {
            // Ù…Ù†Ø§Ø¯Ø§Ø© Ø§Ù„ÙˆØ¸ÙŠÙØ© Ø§Ù„Ù„ÙŠ Ø³ÙˆÙŠÙ†Ø§Ù‡Ø§ ÙÙŠ SQL Editor Ø¯Ø§Ø®Ù„ Supabase
            const response = await fetch(`https://${PROJECT_ID}.supabase.co/rest/v1/rpc/create_paylink_invoice`, {
                method: 'POST',
                headers: {
                    'apikey': ANON_KEY,
                    'Authorization': `Bearer ${ANON_KEY}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({ amount_val: 5 }) // Ø§Ù„Ø³Ø¹Ø± 5 Ø±ÙŠØ§Ù„
            });

            const data = await response.json();

            if (data.url) {
                // Ø§Ù„ØªÙˆØ¬ÙŠÙ‡ Ù„ØµÙØ­Ø© Ø§Ù„Ø¯ÙØ¹ (Ù…Ø¯Ù‰ØŒ Apple PayØŒ ÙÙŠØ²Ø§)
                window.location.href = data.url; 
            } else {
                throw new Error("Ù„Ù… ÙŠØªÙ… Ø§Ø³ØªÙ„Ø§Ù… Ø±Ø§Ø¨Ø· Ø§Ù„Ø¯ÙØ¹ Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±");
            }
        } catch (error) {
            console.error(error);
            alert("Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„. ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Supabase.");
            btn.disabled = false;
            status.innerText = "ÙØ´Ù„ Ø§Ù„Ø·Ù„Ø¨ØŒ Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.";
        }
    }
</script>

</body>
</html>
