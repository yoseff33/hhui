<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
  <title>ÙØ§ØªÙˆØ±Ø© Ø§Ù„ Ø§ÙŠ Ø§Ø± Â· PDF ÙˆØµÙˆØ±Ø©</title>
  <!-- html2pdf Ù…Ø¹ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù…Ø­Ø³Ù‘Ù†Ø© -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <!-- html2canvas Ù„Ø§Ù„ØªÙ‚Ø§Ø· Ø§Ù„ØµÙˆØ± (Ù…ÙˆØ¬ÙˆØ¯ Ø¶Ù…Ù† Ø§Ù„Ø­Ø²Ù…Ø© ÙˆÙ„ÙƒÙ† Ù†Ø³ØªØ¯Ø¹ÙŠÙ‡ ØµØ±Ø§Ø­Ø©) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    * { margin:0; padding:0; box-sizing:border-box; font-family:system-ui, 'Segoe UI', Roboto, sans-serif; }
    body { background:#eef2f6; display:flex; justify-content:center; align-items:center; min-height:100vh; padding:1.2rem; }
    .app-card { max-width:820px; width:100%; background:white; border-radius:36px; box-shadow:0 20px 40px -12px #1f4e3d4d; padding:2rem; border:1px solid #e0eae5; }
    h1,h2,h3,p,label,input,button { direction:rtl; text-align:right; }
    input[type="number"], input[readonly], input[type="tel"] { text-align:left; direction:ltr; }
    .input-group { margin-bottom:1.2rem; display:flex; flex-direction:column; }
    label { font-size:0.9rem; font-weight:600; color:#0b4e4b; margin-bottom:0.25rem; }
    input { background:#f9fbfd; border:1.5px solid #cde3de; border-radius:30px; padding:0.8rem 1.5rem; font-size:1rem; outline:none; color:#174339; }
    input:focus { border-color:#008069; box-shadow:0 0 0 3px #b0e5da; }
    input[readonly] { background:#e5f2ef; color:#024d40; }
    .row-2col { display:grid; grid-template-columns:1fr 1fr; gap:1rem; }
    .invoice-preview { background:white; border-radius:28px; padding:2rem; margin:2rem 0; border:1px solid #d0e3dc; box-shadow:0 6px 14px rgba(0,60,40,0.05); }
    .invoice-header { border-bottom:2px solid #d0f0e4; padding-bottom:1.2rem; margin-bottom:1.2rem; display:flex; justify-content:space-between; align-items:flex-start; flex-wrap:wrap; }
    .business-name { font-size:2.2rem; font-weight:800; color:#006653; }
    .badge { background:#ecfdf6; padding:0.3rem 1.2rem; border-radius:40px; font-size:0.8rem; font-weight:600; color:#015d4e; border:1px solid #b2e4d4; white-space:nowrap; }
    .invoice-line { display:flex; justify-content:space-between; align-items:baseline; padding:0.6rem 0.2rem; border-bottom:1px dashed #d2eae1; }
    .invoice-line strong { color:#105e4f; }
    .invoice-line span { background:#f1faf7; padding:0.2rem 1.2rem; border-radius:40px; color:#014d3e; }
    .total-highlight { margin-top:1.5rem; background:#e1f7f0; padding:1rem 2rem; border-radius:60px; font-size:1.3rem; font-weight:700; color:#00634d; display:flex; justify-content:space-between; align-items:center; border:1px solid #9ed9c8; }
    .total-highlight small { font-size:0.8rem; background:#b6ebdb; padding:0.2rem 1rem; border-radius:30px; }
    .action-grid { display:flex; flex-wrap:wrap; gap:1rem; margin-top:2rem; justify-content:center; }
    .btn { border:none; background:white; padding:0.9rem 1.8rem; border-radius:60px; font-size:1rem; font-weight:600; cursor:pointer; display:inline-flex; align-items:center; gap:0.5rem; flex:1 0 auto; min-width:150px; box-shadow:0 6px 14px rgba(0,60,40,0.1); border:1px solid #c0dad2; color:#025544; justify-content:center; }
    .btn-primary { background:#006653; color:white; border:none; }
    .btn-whatsapp { background:#25D366; color:white; border:none; }
    .btn-client { background:#f3fdfa; border:2px solid #008069; color:#006653; }
    .btn-image { background:#ffb347; color:white; border:none; } /* Ù„ÙˆÙ† Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ Ù„Ù„ØµÙˆØ±Ø© */
    .btn:hover { transform:translateY(-2px); box-shadow:0 12px 20px -10px #006653b3; }
    .phone-hint { font-size:0.7rem; color:#45786b; margin-right:1.2rem; }
    .serial-note { font-size:0.7rem; color:#4d7b6f; margin-right:1.2rem; }
    @media (max-width:600px) { .app-card { padding:1.2rem; } .row-2col { grid-template-columns:1fr; } .action-grid { flex-direction:column; } }
  </style>
</head>
<body>
<div class="app-card">
  <div style="display:flex; align-items:center; gap:8px; margin-bottom:1rem;"><span style="font-size:2rem;">ğŸ§¾</span><h2 style="font-weight:700; color:#005f4b;">Ù…Ù†Ø´Ø¦ ÙÙˆØ§ØªÙŠØ± Ø§Ù„ Ø§ÙŠ Ø§Ø± Â· PDF ÙˆØµÙˆØ±Ø©</h2></div>

  <div class="input-group"><label>ğŸ‘¤ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label><input type="text" id="clientName" value="Ù…Ø¤Ø³Ø³Ø© Ø§Ù„Ù…Ø§Ø³Ø©"></div>
  <div class="input-group"><label>ğŸ“± Ø±Ù‚Ù… Ø¬ÙˆØ§Ù„ Ø§Ù„Ø¹Ù…ÙŠÙ„</label><input type="tel" id="clientPhone" value="0501234567" dir="ltr"></div>
  <div class="input-group"><label>ğŸ“‹ ÙˆØµÙ Ø§Ù„Ø®Ø¯Ù…Ø© / Ø§Ù„Ù…Ù†ØªØ¬</label><input type="text" id="desc" value="ØªØ·ÙˆÙŠØ± Ù…ØªØ¬Ø± Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ"></div>
  <div class="input-group"><label>ğŸ’° Ø§Ù„Ù…Ø¨Ù„Øº (Ø±ÙŠØ§Ù„ Ø³Ø¹ÙˆØ¯ÙŠ)</label><input type="number" id="amount" step="0.01" value="2150.00"></div>

  <div class="row-2col">
    <div class="input-group"><label>ğŸ“… Ø§Ù„ØªØ§Ø±ÙŠØ®</label><input type="text" id="dateField" readonly></div>
    <div class="input-group"><label>ğŸ”¢ Ø§Ù„Ø±Ù‚Ù… Ø§Ù„ØªØ³Ù„Ø³Ù„ÙŠ</label><input type="text" id="serialField" readonly><div class="serial-note">â±ï¸ ÙØ±ÙŠØ¯ Ø­Ø³Ø¨ Ø§Ù„ÙˆÙ‚Øª</div></div>
  </div>

  <!-- Ø¹Ù†ØµØ± Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø§Ù„Ù…Ø±Ø§Ø¯ ØªØ­ÙˆÙŠÙ„Ù‡ Ø¥Ù„Ù‰ PDF Ø£Ùˆ ØµÙˆØ±Ø© -->
  <div id="invoicePreview" class="invoice-preview">
    <div class="invoice-header">
      <div class="business-name">Ø§Ù„ Ø§ÙŠ Ø§Ø±</div>
      <div style="display:flex; gap:0.5rem; flex-wrap:wrap;"><span class="badge">Ø³Ø¬Ù„ ØªØ¬Ø§Ø±ÙŠ 2511017050</span><span class="badge">ØºÙŠØ± Ù…Ø³Ø¬Ù„Ø© ÙÙŠ Ø¶Ø±ÙŠØ¨Ø© Ø§Ù„Ù‚ÙŠÙ…Ø© Ø§Ù„Ù…Ø¶Ø§ÙØ©</span></div>
    </div>
    <div class="invoice-line"><strong>Ø§Ù„Ø¹Ù…ÙŠÙ„</strong> <span id="previewClient">Ù…Ø¤Ø³Ø³Ø© Ø§Ù„Ù…Ø§Ø³Ø©</span></div>
    <div class="invoice-line"><strong>Ø§Ù„Ø¬ÙˆØ§Ù„</strong> <span id="previewPhone">Ù Ù¥Ù Ù¡Ù¢Ù£Ù¤Ù¥Ù¦Ù§</span></div>
    <div class="invoice-line"><strong>Ø§Ù„ÙˆØµÙ</strong> <span id="previewDesc">ØªØ·ÙˆÙŠØ± Ù…ØªØ¬Ø± Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</span></div>
    <div class="invoice-line"><strong>Ø§Ù„Ù…Ø¨Ù„Øº (SAR)</strong> <span id="previewAmount">Ù¢Ù¬Ù¡Ù¥Ù Ù«Ù Ù </span></div>
    <div class="invoice-line"><strong>Ø§Ù„ØªØ§Ø±ÙŠØ®</strong> <span id="previewDate">Ù¢Ù Ù¢Ù¥-Ù Ù£-Ù Ù¡</span></div>
    <div class="invoice-line"><strong>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</strong> <span id="previewSerial">INV-1234</span></div>
    <div class="total-highlight"><span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø´Ø§Ù…Ù„ (0% Ø¶Ø±ÙŠØ¨Ø©)</span><span><span id="previewTotal">Ù¢Ù¬Ù¡Ù¥Ù Ù«Ù Ù </span> SAR <small>ØµÙØ± Ø¨Ø§Ù„Ù…Ø¦Ø©</small></span></div>
  </div>

  <div class="action-grid">
    <button class="btn btn-primary" id="generatePDFBtn"><span>â¬‡ï¸</span> PDF</button>
    <button class="btn btn-image" id="saveImageBtn"><span>ğŸ“¸</span> Ø­ÙØ¸ ÙƒØµÙˆØ±Ø©</button>
    <button class="btn btn-whatsapp" id="whatsappShareBtn"><span>ğŸŒ</span> Ø±Ø§Ø¨Ø· ÙˆØ§ØªØ³Ø§Ø¨</button>
    <button class="btn btn-client" id="whatsappClientBtn"><span>ğŸ“</span> Ø£Ø±Ø³Ù„ PDF Ù„Ù„Ø¹Ù…ÙŠÙ„</button>
    <button class="btn btn-image" id="shareImageBtn"><span>ğŸ–¼ï¸</span> Ù…Ø´Ø§Ø±ÙƒØ© ÙƒØµÙˆØ±Ø©</button>
    <button class="btn" id="newInvoiceBtn"><span>â•</span> ÙØ§ØªÙˆØ±Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
  </div>
  <p style="text-align:center; font-size:0.75rem; color:#577e72; margin-top:1.5rem;">PDF Â· ØµÙˆØ±Ø© Â· Ù…Ø´Ø§Ø±ÙƒØ© Â· Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ù…ØªÙˆÙØ±Ø©</p>
</div>

<script>
  (function() {
    // Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø©
    function getTodayString() { const d=new Date(); return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')}`; }
    function generateSerial() { return 'INV-'+Date.now(); }
    function formatCurrency(amount) { let num=parseFloat(amount)||0; return num.toFixed(2).replace(/\d(?=(\d{3})+\.)/g,'$&,'); }

    // Ø¹Ù†Ø§ØµØ±
    const clientInput=document.getElementById('clientName');
    const phoneInput=document.getElementById('clientPhone');
    const descInput=document.getElementById('desc');
    const amountInput=document.getElementById('amount');
    const dateField=document.getElementById('dateField');
    const serialField=document.getElementById('serialField');
    const previewClient=document.getElementById('previewClient');
    const previewPhone=document.getElementById('previewPhone');
    const previewDesc=document.getElementById('previewDesc');
    const previewAmount=document.getElementById('previewAmount');
    const previewDate=document.getElementById('previewDate');
    const previewSerial=document.getElementById('previewSerial');
    const previewTotal=document.getElementById('previewTotal');
    const invoicePreviewDiv=document.getElementById('invoicePreview');

    function updatePreview() {
      previewClient.textContent = clientInput.value.trim() || 'â€”';
      previewPhone.textContent = phoneInput.value.trim() || 'â€”';
      previewDesc.textContent = descInput.value.trim() || 'â€”';
      let amountNum = parseFloat(amountInput.value) || 0;
      previewAmount.textContent = formatCurrency(amountNum);
      previewDate.textContent = dateField.value;
      previewSerial.textContent = serialField.value;
      previewTotal.textContent = formatCurrency(amountNum);
    }

    function setAutomaticFields() { dateField.value = getTodayString(); serialField.value = generateSerial(); }
    function initializeFromParams() {
      const urlParams=new URLSearchParams(window.location.search);
      dateField.value = (urlParams.get('date') && /^\d{4}-\d{2}-\d{2}$/.test(urlParams.get('date'))) ? urlParams.get('date') : getTodayString();
      serialField.value = urlParams.get('serial') || generateSerial();
      clientInput.value = urlParams.get('client') ? decodeURIComponent(urlParams.get('client')) : 'Ù…Ø¤Ø³Ø³Ø© Ø§Ù„Ù…Ø§Ø³Ø©';
      phoneInput.value = urlParams.get('phone') ? decodeURIComponent(urlParams.get('phone')) : '0501234567';
      descInput.value = urlParams.get('desc') ? decodeURIComponent(urlParams.get('desc')) : 'ØªØ·ÙˆÙŠØ± Ù…ØªØ¬Ø± Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ';
      let amount = parseFloat(urlParams.get('amount'));
      amountInput.value = !isNaN(amount) ? amount.toFixed(2) : '2150.00';
      updatePreview();
    }

    // ========== Ø¯Ø§Ù„Ø© PDF Ø§Ù„Ù…Ø­Ø³Ù‘Ù†Ø© ==========
    async function generatePDF() {
      const element = document.getElementById('invoicePreview');
      if (!element) throw new Error('Ø¹Ù†ØµØ± Ø§Ù„ÙØ§ØªÙˆØ±Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');

      const scrollX = window.scrollX;
      const scrollY = window.scrollY;
      window.scrollTo(0, 0);
      await new Promise(resolve => setTimeout(resolve, 300));
      const rect = element.getBoundingClientRect();

      const opt = {
        margin: [0.5, 0.5, 0.5, 0.5],
        filename: `ÙØ§ØªÙˆØ±Ø©_${serialField.value}.pdf`,
        image: { type: 'jpeg', quality: 0.98 },
        html2canvas: {
          scale: window.devicePixelRatio || 2,
          scrollY: 0, scrollX: 0,
          windowWidth: document.documentElement.clientWidth,
          windowHeight: document.documentElement.clientHeight,
          useCORS: true,
          backgroundColor: '#ffffff',
          width: rect.width,
          height: rect.height
        },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' },
      };

      try {
        await html2pdf().set(opt).from(element).save();
      } finally {
        window.scrollTo(scrollX, scrollY);
      }
    }

    // ========== Ø¯ÙˆØ§Ù„ Ø§Ù„ØµÙˆØ±Ø© ==========
    // Ø¯Ø§Ù„Ø© Ù…Ø´ØªØ±ÙƒØ© Ù„Ø§Ù„ØªÙ‚Ø§Ø· ØµÙˆØ±Ø© Ù„Ù„Ø¹Ù†ØµØ±
    async function captureImage() {
      const element = document.getElementById('invoicePreview');
      if (!element) throw new Error('Ø¹Ù†ØµØ± Ø§Ù„ÙØ§ØªÙˆØ±Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯');

      const scrollX = window.scrollX;
      const scrollY = window.scrollY;
      window.scrollTo(0, 0);
      await new Promise(resolve => setTimeout(resolve, 300));
      const rect = element.getBoundingClientRect();

      // Ø§Ø³ØªØ®Ø¯Ø§Ù… html2canvas Ù…Ø¨Ø§Ø´Ø±Ø©
      const canvas = await html2canvas(element, {
        scale: window.devicePixelRatio || 2,
        scrollY: 0,
        scrollX: 0,
        windowWidth: document.documentElement.clientWidth,
        windowHeight: document.documentElement.clientHeight,
        useCORS: true,
        backgroundColor: '#ffffff',
        width: rect.width,
        height: rect.height,
        logging: false
      });

      window.scrollTo(scrollX, scrollY);
      return canvas;
    }

    // Ø­ÙØ¸ ÙƒØµÙˆØ±Ø© (ØªØ­Ù…ÙŠÙ„)
    async function saveAsImage() {
      try {
        const canvas = await captureImage();
        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙƒØ§Ù†ÙØ§Ø³ Ø¥Ù„Ù‰ Ø±Ø§Ø¨Ø· ÙˆØªØ­Ù…ÙŠÙ„Ù‡
        const link = document.createElement('a');
        link.download = `ÙØ§ØªÙˆØ±Ø©_${serialField.value}.png`;
        link.href = canvas.toDataURL('image/png');
        link.click();
      } catch (err) {
        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø­ÙØ¸ Ø§Ù„ØµÙˆØ±Ø©: ' + err.message);
        console.error(err);
      }
    }

    // Ù…Ø´Ø§Ø±ÙƒØ© ÙƒØµÙˆØ±Ø© Ø¹Ø¨Ø± Web Share
    async function shareImage() {
      try {
        const canvas = await captureImage();
        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙƒØ§Ù†ÙØ§Ø³ Ø¥Ù„Ù‰ blob
        const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/png'));
        const file = new File([blob], `ÙØ§ØªÙˆØ±Ø©_${serialField.value}.png`, { type: 'image/png' });

        if (navigator.canShare && navigator.canShare({ files: [file] })) {
          await navigator.share({
            files: [file],
            title: 'Ø§Ù„ÙØ§ØªÙˆØ±Ø©',
            text: 'ÙØ§ØªÙˆØ±Ø© Ù…Ù† Ø§Ù„ Ø§ÙŠ Ø§Ø±'
          });
        } else {
          // Ø¥Ø°Ø§ Ù„Ù… ÙŠØ¯Ø¹Ù… Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ©ØŒ Ù†Ù†Ø²Ù„ Ø§Ù„ØµÙˆØ±Ø©
          const link = document.createElement('a');
          link.download = `ÙØ§ØªÙˆØ±Ø©_${serialField.value}.png`;
          link.href = canvas.toDataURL('image/png');
          link.click();
          alert('Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…Ø©ØŒ ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø© Ø¨Ø¯Ù„Ø§Ù‹ Ù…Ù† Ø°Ù„Ùƒ.');
        }
      } catch (err) {
        console.error(err);
        alert('ØªØ¹Ø°Ø±Øª Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„ØµÙˆØ±Ø©ØŒ Ø¬Ø±Ø¨ Ø­ÙØ¸Ù‡Ø§ Ø£ÙˆÙ„Ø§Ù‹.');
      }
    }

    // Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ…
    document.getElementById('generatePDFBtn').addEventListener('click', async () => {
      try { await generatePDF(); } catch (err) { alert(err.message); }
    });

    document.getElementById('saveImageBtn').addEventListener('click', saveAsImage);
    document.getElementById('shareImageBtn').addEventListener('click', shareImage);

    document.getElementById('whatsappShareBtn').addEventListener('click', function() {
      const params = new URLSearchParams({
        client: clientInput.value,
        phone: phoneInput.value,
        desc: descInput.value,
        amount: parseFloat(amountInput.value).toFixed(2),
        serial: serialField.value,
        date: dateField.value
      });
      const link = window.location.origin + window.location.pathname + '?' + params.toString();
      const text = `ÙØ§ØªÙˆØ±Ø© Ù…Ù† Ø§Ù„ Ø§ÙŠ Ø§Ø±\nØ§Ù„Ø¹Ù…ÙŠÙ„: ${clientInput.value}\nØ§Ù„Ù…Ø¨Ù„Øº: ${amountInput.value} SAR\nØ±Ø§Ø¨Ø· Ø§Ù„ÙØ§ØªÙˆØ±Ø©: ${link}`;
      window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
    });

    document.getElementById('whatsappClientBtn').addEventListener('click', async function() {
      try {
        const element = document.getElementById('invoicePreview');
        const scrollX = window.scrollX;
        const scrollY = window.scrollY;
        window.scrollTo(0, 0);
        await new Promise(resolve => setTimeout(resolve, 300));
        const rect = element.getBoundingClientRect();
        const opt = {
          margin: [0.5,0.5,0.5,0.5],
          filename: `ÙØ§ØªÙˆØ±Ø©_${serialField.value}.pdf`,
          image: { type: 'jpeg', quality: 0.98 },
          html2canvas: {
            scale: window.devicePixelRatio || 2,
            scrollY: 0, scrollX: 0,
            windowWidth: document.documentElement.clientWidth,
            windowHeight: document.documentElement.clientHeight,
            useCORS: true, backgroundColor: '#ffffff',
            width: rect.width, height: rect.height
          },
          jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' },
        };
        const blob = await html2pdf().set(opt).from(element).output('blob');
        window.scrollTo(scrollX, scrollY);

        const file = new File([blob], `ÙØ§ØªÙˆØ±Ø©_${serialField.value}.pdf`, { type: 'application/pdf' });
        if (navigator.canShare && navigator.canShare({ files: [file] })) {
          await navigator.share({ files: [file], title: 'Ø§Ù„ÙØ§ØªÙˆØ±Ø©', text: 'ÙØ§ØªÙˆØ±Ø© Ù…Ù† Ø§Ù„ Ø§ÙŠ Ø§Ø±' });
        } else {
          const link = document.createElement('a');
          link.href = URL.createObjectURL(blob);
          link.download = `ÙØ§ØªÙˆØ±Ø©_${serialField.value}.pdf`;
          link.click();
          URL.revokeObjectURL(link.href);
          alert('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù PDFØŒ ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø±Ø³Ø§Ù„Ù‡ ÙŠØ¯ÙˆÙŠØ§Ù‹ Ø¹Ø¨Ø± ÙˆØ§ØªØ³Ø§Ø¨.');
        }
      } catch (err) {
        console.error(err);
        alert('ØªØ¹Ø°Ø±Øª Ù…Ø´Ø§Ø±ÙƒØ© PDFØŒ Ø¬Ø±Ø¨ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø£ÙˆÙ„Ø§Ù‹.');
      }
    });

    document.getElementById('newInvoiceBtn').addEventListener('click', function() {
      clientInput.value = ''; phoneInput.value = ''; descInput.value = ''; amountInput.value = '';
      dateField.value = getTodayString(); serialField.value = generateSerial();
      updatePreview();
    });

    // Ø±Ø¨Ø· Ø§Ù„ØªØ­Ø¯ÙŠØ«
    clientInput.addEventListener('input', updatePreview);
    phoneInput.addEventListener('input', updatePreview);
    descInput.addEventListener('input', updatePreview);
    amountInput.addEventListener('input', updatePreview);

    setAutomaticFields();
    initializeFromParams();
  })();
</script>
</body>
</html>